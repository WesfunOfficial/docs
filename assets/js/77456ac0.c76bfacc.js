"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[300],{1243:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var s=r(5893),i=r(1151);const t={sidebar_position:1},o="Overview",a={id:"packaging/triggers/overview",title:"Overview",description:"Serpent OS supports the use of triggers, or actions, that run at the end of package installations.",source:"@site/docs/packaging/triggers/overview.md",sourceDirName:"packaging/triggers",slug:"/packaging/triggers/overview",permalink:"/docs/packaging/triggers/overview",draft:!1,unlisted:!1,editUrl:"https://github.com/serpent-os/docs/tree/main/docs/packaging/triggers/overview.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"packageSidebar",previous:{title:"Triggers",permalink:"/docs/category/triggers"},next:{title:"Transaction Triggers",permalink:"/docs/packaging/triggers/tx_triggers"}},c={},d=[{value:"Basic mechanism",id:"basic-mechanism",level:2},{value:"Capturing globs",id:"capturing-globs",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Serpent OS supports the use of triggers, or actions, that run at the end of package installations.\nGiven the significantly different architecture of Serpent OS, these triggers may not be quite what\nyou are used to in other distributions or package managers."}),"\n",(0,s.jsx)(n.h2,{id:"basic-mechanism",children:"Basic mechanism"}),"\n",(0,s.jsxs)(n.p,{children:["After a new transaction is formed and ",(0,s.jsx)(n.code,{children:"moss"})," has identified all of the paths used to compose a filesystem,\nthe staging tree is built as the basis of the new ",(0,s.jsx)(n.code,{children:"/usr"}),". Any trigger files (under ",(0,s.jsx)(n.code,{children:"/usr/share/moss/triggers"}),")\nwill be loaded, and any ",(0,s.jsx)(n.strong,{children:"matching"})," triggers will be executed at the appropriate stage."]}),"\n",(0,s.jsxs)(n.p,{children:["Note that trigger logic is based on ",(0,s.jsx)(n.code,{children:"glob"}),"-style path matches and are not incremental. Our triggers were so\ndesigned to avoid the uncontrolled execution of arbitrary scripts, instead relying on logical matching of\npatterns to handlers."]}),"\n",(0,s.jsx)(n.h2,{id:"capturing-globs",children:"Capturing globs"}),"\n",(0,s.jsxs)(n.p,{children:["Our triggers use special string tokens to permit capturing groups from a glob-style string. At this stage we\nsupport ",(0,s.jsx)(n.code,{children:"*"})," and ",(0,s.jsx)(n.code,{children:"?"})," glob characters only, compiling to a regex internally. Support is planned for braces."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    /usr/lib/(GROUP_NAME:PATTERN)/dir\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The parenthesis begin a non-greedy capture group named ",(0,s.jsx)(n.code,{children:"GROUP_NAME"})," containing pattern ",(0,s.jsx)(n.code,{children:"PATTERN"}),". For example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    /usr/share/icons/(name:*)/index.theme\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This creates a capture group identifed by ",(0,s.jsx)(n.code,{children:"name"})," matching ",(0,s.jsx)(n.code,{children:"*"})," in ",(0,s.jsx)(n.code,{children:"/usr/share/icons/*/index.theme"}),". As such,\nthe path ",(0,s.jsx)(n.code,{children:"/usr/share/icons/hicolor/index.theme"}),". with ",(0,s.jsx)(n.code,{children:"name"})," being set to ",(0,s.jsx)(n.code,{children:"hicolor"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"This is a powerful mechanism that allows us to control handler execution without relying on interim scripts."}),"\n",(0,s.jsx)(n.p,{children:"Consider this example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"    /usr/lib*/(libname:lib*.so.*)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will only match ",(0,s.jsx)(n.code,{children:"lib*.so.*"})," glob, and set ",(0,s.jsx)(n.code,{children:"libname"})," to ",(0,s.jsx)(n.code,{children:"libz.so.1"})," for ",(0,s.jsx)(n.code,{children:"/usr/lib32/libz.so.1"}),", but will not\nmatch for ",(0,s.jsx)(n.code,{children:"/usr/lib64/libz.so"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"These globs are then used for string substitution in the arguments passed to handlers."})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>o});var s=r(7294);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);